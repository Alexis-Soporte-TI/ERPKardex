<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="mb-3">
                <label for="txt_PeligrosidadCodigo" class="font-weight-bold">Código de Peligrosidad</label>
                <div class="input-group">
                    <input type="text" id="txt_PeligrosidadCodigo" class="form-control" placeholder="Ej: CAT-01, NIVEL-1" oninput="this.value = this.value.toUpperCase();">
                    <div class="input-group-append">
                        <div class="input-group-text"><i class="fas fa-exclamation-triangle"></i></div>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label for="txt_PeligrosidadDescripcion" class="font-weight-bold">Descripción del Riesgo</label>
                <div class="input-group">
                    <input type="text" id="txt_PeligrosidadDescripcion" class="form-control" placeholder="Ej: LIGERAMENTE PELIGROSO" oninput="this.value = this.value.toUpperCase();">
                    <div class="input-group-append">
                        <div class="input-group-text"><i class="fas fa-notes-medical"></i></div>
                    </div>
                </div>
            </div>

            <div class="text-center mt-4">
                <button id="btn_CancelarPeligrosidad" type="button" class="btn btn-danger" data-dismiss="modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button id="btn_GuardarPeligrosidad" type="button" class="btn btn-primary">
                    <i class="fas fa-save"></i> Registrar Peligrosidad
                </button>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).off('click', '#btn_GuardarPeligrosidad').on('click', '#btn_GuardarPeligrosidad', function () {
        // 1. Recolección de datos
        let codigo = $("#txt_PeligrosidadCodigo").val().trim();
        let descripcion = $("#txt_PeligrosidadDescripcion").val().trim();

        // 2. Validaciones básicas
        if (!codigo || !descripcion) {
            toastr.warning("Todos los campos son obligatorios para registrar la peligrosidad", "MENSAJE DE SISTEMA");
            return;
        }

        // 3. Confirmación con SweetAlert2
        Swal.fire({
            title: "¿Registrar Nivel de Peligrosidad?",
            text: `Se registrará: ${descripcion}`,
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Sí, registrar",
            cancelButtonText: "Cancelar",
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {

                // 4. Objeto para el controlador
                let pPeligrosidad = {
                    Codigo: codigo,
                    Descripcion: descripcion
                };

                $.ajax({
                    url: "/Producto/RegistrarPeligrosidad",
                    type: "POST",
                    data: pPeligrosidad,
                    success: function (response) {
                        if (response.status === true) {
                            toastr.success(response.message, "MENSAJE DE SISTEMA");

                            // 5. Refrescar el combo en la pantalla principal
                            fct_FillCombo('/Producto/GetPeligrosidadData', '#cbx_Peligrosidad', 'codigo', 'descripcion', '-- SELECCIONAR PELIGROSIDAD --');

                            // 6. Cerrar el modal
                            $("#dynamic-modal").modal('hide');
                        } else {
                            toastr.warning(response.message, 'MENSAJE DE SISTEMA');
                        }
                    },
                    error: function (xhr) {
                        toastr.error("Error en el servidor al procesar la peligrosidad", "MENSAJE DE SISTEMA");
                    }
                });
            }
        });
    });
</script>