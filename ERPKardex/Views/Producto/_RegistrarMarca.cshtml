<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="mb-3">
                <label for="txt_MarcaNombre" class="font-weight-bold">Nombre de Marca</label>
                <input type="text" id="txt_MarcaNombre" class="form-control" placeholder="Ej: Bayer" oninput="this.value = this.value.toUpperCase();">
            </div>
            <div class="mb-3">
                <label for="cbx_MarcaEstado" class="font-weight-bold">Estado</label>
                <select id="cbx_MarcaEstado" class="form-control">
                    <option value="1">ACTIVO</option>
                    <option value="0">INACTIVO</option>
                </select>
            </div>
            <div class="text-center mt-4">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
                <button id="btn_GuardarMarca" type="button" class="btn btn-primary">Registrar</button>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).off('click', '#btn_GuardarMarca').on('click', '#btn_GuardarMarca', function () {
        // 1. Recolección de datos
        let nombre = $("#txt_MarcaNombre").val().trim();
        let estado = $("#cbx_MarcaEstado").val();

        // 2. Validaciones básicas
        if (!nombre) {
            toastr.warning("Debe ingresar el nombre de la marca", "MENSAJE DE SISTEMA");
            return;
        }

        // 3. Confirmación con SweetAlert2
        Swal.fire({
            title: "¿Registrar Marca?",
            text: `Se registrará la marca: ${nombre}`,
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Sí, registrar",
            cancelButtonText: "Cancelar",
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {

                // 4. Objeto para el controlador (coincide con tu tabla marca)
                let pMarca = {
                    Nombre: nombre,
                    Estado: estado === "1"
                };

                $.ajax({
                    url: "/Producto/RegistrarMarca",
                    type: "POST",
                    data: pMarca,
                    success: function (response) {
                        if (response.status === true) {
                            toastr.success(response.message, "MENSAJE DE SISTEMA");

                            // 5. Refrescar el combo en la pantalla principal
                            fct_FillCombo('/Producto/GetMarcaData', '#cbx_Marca', 'id', 'nombre', '-- SELECCIONAR MARCA --', 'id');

                            // 6. Cerrar el modal
                            $("#dynamic-modal").modal('hide');
                        } else {
                            toastr.warning(response.message, 'MENSAJE DE SISTEMA');
                        }
                    },
                    error: function (xhr) {
                        toastr.error("Error en el servidor al procesar la marca", "MENSAJE DE SISTEMA");
                    }
                });
            }
        });
    });
</script>