<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="mb-3">
                <label for="txt_EmpresaRuc" class="font-weight-bold">RUC (11 dígitos)</label>
                <input type="text" id="txt_EmpresaRuc" class="form-control" maxlength="11" placeholder="00000000000">
            </div>
            <div class="mb-3">
                <label for="txt_EmpresaRazonSocial" class="font-weight-bold">Razón Social</label>
                <input type="text" id="txt_EmpresaRazonSocial" class="form-control" placeholder="Nombre de la empresa" oninput="this.value = this.value.toUpperCase();">
            </div>
            <div class="mb-3">
                <label for="cbx_EmpresaEstado" class="font-weight-bold">Estado</label>
                <select id="cbx_EmpresaEstado" class="form-control">
                    <option value="1">ACTIVO</option>
                    <option value="0">INACTIVO</option>
                </select>
            </div>
            <div class="text-center mt-4">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
                <button id="btn_GuardarEmpresa" type="button" class="btn btn-primary">Registrar</button>
            </div>
        </div>
    </div>
</div>
<script>
        $(document).off('click', '#btn_GuardarEmpresa').on('click', '#btn_GuardarEmpresa', function () {
        // 1. Recolección de datos
        let ruc = $("#txt_EmpresaRuc").val().trim();
        let razonSocial = $("#txt_EmpresaRazonSocial").val().trim();
        let estado = $("#cbx_EmpresaEstado").val();

        // 2. Validaciones básicas
        if (!ruc || !razonSocial || !estado) {
            toastr.warning("Todos los campos son obligatorios", "MENSAJE DE SISTEMA");
            return;
        }

        if (ruc.length !== 11) {
            toastr.warning("El RUC debe tener exactamente 11 dígitos.", "MENSAJE DE SISTEMA");
            return;
        }

        // 3. Confirmación con SweetAlert2
        Swal.fire({
            title: "¿Registrar Empresa?",
            text: `Se registrará: ${razonSocial}`,
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Sí, registrar",
            cancelButtonText: "Cancelar",
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {

                // 4. Preparación de datos (FormData o Objeto Plano)
                // Como tu controlador recibe (Empresa empresa), un objeto JSON es más directo
                let pEmpresa = {
                    Ruc: ruc,
                    RazonSocial: razonSocial,
                    Estado: estado === "1"
                };

                $.ajax({
                    url: "/Producto/RegistrarEmpresa",
                    type: "POST",
                    data: pEmpresa, // Enviamos como objeto para que coincida con el modelo en C#
                    success: function (response) {
                        if (response.status === true) {
                            toastr.success(response.message, "MENSAJE DE SISTEMA");

                            // 5. Refrescar el combo de la pantalla principal
                            fct_FillCombo('/Producto/GetEmpresaData', '#cbx_Empresa', 'id', 'razonSocial', '-- SELECCIONAR EMPRESA --');

                            // 6. Cerrar el modal dinámico
                            $("#dynamic-modal").modal('hide');
                        } else {
                            toastr.warning(response.message, 'MENSAJE DE SISTEMA');
                        }
                    },
                    error: function (xhr, status, error) {
                        toastr.error("Error en el servidor al registrar empresa", "MENSAJE DE SISTEMA");
                        console.error('XHR:', xhr);
                    }
                });
            }
        });
    });
</script>