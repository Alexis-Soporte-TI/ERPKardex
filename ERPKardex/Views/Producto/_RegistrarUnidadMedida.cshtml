<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="mb-3">
                <label for="txt_UnidadCodigo" class="font-weight-bold">Código de Unidad</label>
                <div class="input-group">
                    <input type="text" id="txt_UnidadCodigo" class="form-control" placeholder="Ej: UND, KG, LTS" oninput="this.value = this.value.toUpperCase();">
                    <div class="input-group-append">
                        <div class="input-group-text"><i class="fas fa-tag"></i></div>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label for="txt_UnidadDescripcion" class="font-weight-bold">Descripción</label>
                <div class="input-group">
                    <input type="text" id="txt_UnidadDescripcion" class="form-control" placeholder="Ej: UNIDADES, KILOGRAMOS" oninput="this.value = this.value.toUpperCase();">
                    <div class="input-group-append">
                        <div class="input-group-text"><i class="fas fa-balance-scale"></i></div>
                    </div>
                </div>
            </div>

            <div class="text-center mt-4">
                <button id="btn_CancelarUnidad" type="button" class="btn btn-danger" data-dismiss="modal">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button id="btn_GuardarUnidad" type="button" class="btn btn-primary">
                    <i class="fas fa-save"></i> Registrar Unidad
                </button>
            </div>
        </div>
    </div>
</div>
<script>
        $(document).off('click', '#btn_GuardarUnidad').on('click', '#btn_GuardarUnidad', function () {
        // 1. Recolección de datos
        let codigo = $("#txt_UnidadCodigo").val().trim();
        let descripcion = $("#txt_UnidadDescripcion").val().trim();

        // 2. Validaciones básicas
        if (!codigo || !descripcion) {
            toastr.warning("Debe ingresar el código y la descripción de la unidad", "MENSAJE DE SISTEMA");
            return;
        }

        // 3. Confirmación con SweetAlert2
        Swal.fire({
            title: "¿Registrar Unidad de Medida?",
            text: `Se registrará la unidad: ${descripcion}`,
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Sí, registrar",
            cancelButtonText: "Cancelar",
            reverseButtons: true
        }).then((result) => {
            if (result.isConfirmed) {

                // 4. Objeto para el controlador
                let pUnidad = {
                    Codigo: codigo,
                    Descripcion: descripcion
                };

                $.ajax({
                    url: "/Producto/RegistrarUnidadMedida",
                    type: "POST",
                    data: pUnidad,
                    success: function (response) {
                        if (response.status === true) {
                            toastr.success(response.message, "MENSAJE DE SISTEMA");

                            // 5. Refrescar el combo en la pantalla principal
                            fct_FillCombo('/Producto/GetUMedidaData', '#cbx_UnidadMedida', 'codigo', 'descripcion', '-- SELECCIONAR U. MEDIDA --');

                            // 6. Cerrar el modal
                            $("#dynamic-modal").modal('hide');
                        } else {
                            toastr.warning(response.message, 'MENSAJE DE SISTEMA');
                        }
                    },
                    error: function (xhr) {
                        toastr.error("Error en el servidor al procesar la unidad de medida", "MENSAJE DE SISTEMA");
                        console.error(xhr);
                    }
                });
            }
        });
    });
</script>